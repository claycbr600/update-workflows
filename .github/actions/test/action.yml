name: Close Issue

inputs:
  commit_sha:
    description: 'Commit sha of release tag'
    required: true

runs:
  using: composite

  steps:
    - name: Get release tag
      uses: actions/github-script@v5
      id: release-tag
      with:
        result-encoding: string
        script: |
          const commit_sha = "${{ inputs.commit_sha }}"
          const resp = await octokit.rest.repos.listTags({
            owner: context.repo.owner,
            repo: context.repo.repo
          });
          const tags = resp.data
          for (const tag of tags) {
            if (tag.commit.sha == commit_sha) {
              console.log("found tag %s for commit %s", tag.name, commit_sha)
              return tag.name
            } else {
              console.log("skipping tag %s with commit %s", tag.name, tag.commit.sha)
            }
          }

    - name: print release tag
      shell: bash
      run: echo "tag = ${{ steps.release-tag.outputs.result }}"
